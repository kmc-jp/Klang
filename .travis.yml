language: cpp
compiler:
  - gcc
  - clang
env:
  - VER=gcc-4.7
  - VER=gcc-4.8
  - VER=gcc-4.9
  - VER=clang-3.4
  - VER=clang-3.5
matrix:
  exclude:
    - compiler: clang
      env: VER=gcc-4.7
    - compiler: clang
      env: VER=gcc-4.8
    - compiler: clang
      env: VER=gcc-4.9
    - compiler: gcc
      env: VER=clang-3.4
    - compiler: gcc
      env: VER=clang-3.5

before_install:
  - sudo apt-get -qq update
install:
  - sudo apt-get install -qq gnulib #stdbool.m4 is required for AC_CHECK_HEADER_STDBOOL in configure.ac
  - if [ "$VER" = "gcc-4.7" ]; then
      sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test;
      sudo apt-get -qq update;
      sudo apt-get -qq install g++-4.7;
      export CXX="g++-4.7";
    fi
  - if [ "$VER" = "gcc-4.8" ]; then
      sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test;
      sudo apt-get -qq update;
      sudo apt-get -qq install g++-4.8;
      export CXX="g++-4.8";
    fi
  - if [ "$VER" = "gcc-4.9" ]; then
      sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test;
      sudo apt-get -qq update;
      sudo apt-get -qq install g++-4.9;
      export CXX="g++-4.9";
    fi
  - if [ "$VER" = "clang-3.4" ]; then
      echo do nothing;
    fi
  - if [ "$VER" = "clang-3.5" ]; then
      sudo sh -c "echo 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise-3.5 main' >> /etc/apt/sources.list";
      sudo sh -c "echo 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise main' >> /etc/apt/sources.list";
      wget -O - http://llvm.org/apt/llvm-snapshot.gpg.key | sudo apt-key add -;
      sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test;
      sudo apt-get -qq update;
      sudo apt-get -qq install llvm-3.5 clang-3.5;
      export CXX="clang++-3.5";
    fi
  - $CXX --version
  - echo $CXX
  - ACLOCAL_ARGS="-I/usr/share/gnulib/m4" ./autogen.sh
  - ./configure
  - make
script:
  - make check

notifications:
  emails:
    - klang-project@kmc.gr.jp
  on_success: change
  on_failure: always
